{% extends "base.html" %}
{% block content %}

<div class="max-w-5xl mx-auto bg-gray-800 p-6 rounded-lg shadow text-gray-100">
  <div class="flex justify-between items-center mb-4">
    <h2 class="text-2xl font-semibold">ü™µ Live Log Stream</h2>
    <div class="flex gap-2">
      <button id="pauseBtn"
              class="bg-yellow-600 hover:bg-yellow-500 text-white py-1 px-3 rounded text-sm">
        ‚è∏Ô∏è Pause
      </button>
      <a href="/" class="bg-blue-600 hover:bg-blue-500 text-white py-1 px-3 rounded text-sm">‚Üê Back</a>
    </div>
  </div>

  <pre id="log-content"
       class="bg-gray-900 p-3 rounded overflow-y-scroll h-[500px] text-sm leading-tight text-gray-300 font-mono"></pre>
</div>

<script>
let autoScroll = true;
const logEl = document.getElementById("log-content");
const pauseBtn = document.getElementById("pauseBtn");

function connectWebSocket() {
  const wsProtocol = location.protocol === "https:" ? "wss" : "ws";
  const socket = new WebSocket(`${wsProtocol}://${location.host}/ws/logs`);

  socket.addEventListener("open", () => {
    console.log("‚úÖ Connected to /ws/logs");
  });

  socket.addEventListener("message", (event) => {
    logEl.textContent += event.data;
    if (autoScroll) logEl.scrollTop = logEl.scrollHeight;
  });

  socket.addEventListener("close", () => {
    console.warn("‚ö†Ô∏è WebSocket closed, retrying in 3s...");
    setTimeout(connectWebSocket, 3000); // üîÅ Auto-reconnect
  });

  socket.addEventListener("error", (err) => {
    console.error("WebSocket error:", err);
    socket.close();
  });
}

pauseBtn.addEventListener("click", () => {
  autoScroll = !autoScroll;
  if (autoScroll) {
    pauseBtn.textContent = "‚è∏Ô∏è Pause";
    pauseBtn.classList.replace("bg-green-600", "bg-yellow-600");
  } else {
    pauseBtn.textContent = "‚ñ∂Ô∏è Resume";
    pauseBtn.classList.replace("bg-yellow-600", "bg-green-600");
  }
});

connectWebSocket();
</script>

{% endblock %}